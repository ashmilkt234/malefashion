<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= product ? product.productName : "Male-Fashion" %> - Product Details</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

  <!-- CSS Files -->
  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="/css/elegant-icons.css" type="text/css">
  <link rel="stylesheet" href="/css/magnific-popup.css" type="text/css">
  <link rel="stylesheet" href="/css/nice-select.css" type="text/css">
  <link rel="stylesheet" href="/css/owl.carousel.min.css" type="text/css">
  <link rel="stylesheet" href="/css/slicknav.min.css" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/css/header.css" type="text/css">
  <link rel="stylesheet" href="/css/productdetail.css">
  <link rel="shortcut icon" href="/img/hero/cr.jpg" type="image/png">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/3.0.8/jquery.elevatezoom.min.js"></script>

</head>
<body>

  <%- include("partials/user/header") %>

  <div class="container">
    <nav class="breadcrumb">
      <% if (typeof breadcrumb !== "undefined") { %>
        <% breadcrumb.forEach((crumb, index) => { %>
          <% if(index < breadcrumb.length - 1){ %>
            <a href="<%= crumb.url %>"><%= crumb.name %></a> &gt; 
          <% } else { %>
            <span><%= crumb.name %></span>
          <% } %>
        <% }) %>
      <% } %>
    </nav>

    <div class="product-detail">
      <!-- Thumbnail Column -->
      <div class="thumbnail-column">
        <% product.productImage.forEach((img, index) => { %>
          <img src="/Uploads/product-images/<%= img %>" 
               onclick="changeImage(this)" 
               class="<%= index === 0 ? 'active' : '' %>"
               alt="<%= product.productName %>">
        <% }) %>
      </div>

   <!-- <div class="main-img-container">
  <img id="mainImage" class="main-img"
       src="/Uploads/product-images/<%= product.productImage[0] %>"
       data-zoom-image="/Uploads/product-images/<%= product.productImage[0] %>"
       alt="<%= product.productName %>">
</div> -->

<img
  id="mainImage"
  class="main-img zoom-img"
  src="/uploads/product-images/<%= product.productImage[0] %>"
  data-zoom-image="/uploads/product-images/<%= product.productImage[0] %>"
  alt="<%= product.productName %>"
>


      <!-- Product Info -->
      <div class="product-info">
        <h1><%= product.productName %></h1>
        
        <div class="rating-section">
          <div class="rating">
            <% let rating = product.rating || 4; %>
            <% for(let i=0; i<5; i++) { %>
              <% if(i < rating) { %>
                <i class="fa fa-star"></i>
              <% } else { %>
                <i class="fa fa-star-o"></i>
              <% } %>
            <% } %>
          </div>
          <span class="review-count">(120 Reviews)</span>
          <button class="wishlist-btn">
            <i class="fa fa-heart-o"></i>
          </button>
        </div>
<div class="price-section">
  <span 
    class="price" 
    id="totalPrice" 
    data-base-price="<%= product.salesPrice %>">
    â‚¹<%= product.salesPrice %>
  </span>

  <span 
    class="original-price" 
    id="originalPrice"
    data-original-price="<%= Math.round(product.salesPrice * 1.3) %>">
    â‚¹<%= Math.round(product.salesPrice * 1.3) %>
  </span>
</div>

      
        <p class="product-description">
          <%= product.about || 'Oxford cotton shirt with a button-down collar, chest pocket, and long sleeves. Regular fit with a classic silhouette.' %>
        </p>

    <% if (product.sizes && product.sizes.length > 0) { %>
  <div class="product-sizes mt-3">
    <h6>Select Size</h6>

    <div class="size-options">
      <% product.sizes.forEach(size => { %>
        <label class="size-box">
          <input type="radio" name="size" value="<%= size %>">
          <span><%= size %></span>
        </label>
      <% }) %>
    </div>
  </div>
<% } %>
<% if (isBlocked) { %>
  <div class="alert alert-danger" style="margin: 15px 0;">
    ðŸš« This product is currently unavailable.
  </div>
<% } %>


   


<!-- Quantity and Action Buttons -->
<div class="action-section">
  <div class="quantity-selector">
    <button onclick="decreaseQty()">âˆ’</button>
    <input type="number" id="quantity" value="1" min="1" readonly>
    <button onclick="increaseQty()">+</button>
  </div>
<% if (isBlocked) { %>
  <button class="btn btn-secondary" disabled>Product Unavailable</button>
  <button class="btn btn-secondary" disabled>Buy Now</button>
<% } else { %>
  <a href="#" class="btn btn-cart">Add to Cart</a>
  <a href="#" class="btn btn-buy">Buy Now</a>
<% } %>
  <div class="cart-icon">
    <i class="fa fa-shopping-cart"></i>
  </div>
</div>


        <!-- Delivery Info -->
        <div class="delivery-info">
          <div class="info-item">
            <i class="fa fa-truck"></i>
            <div>
              <h4>Free Delivery</h4>
              <p>Enter your postal code for Delivery Availability</p>
            </div>
          </div>
          <div class="info-item">
            <i class="fa fa-refresh"></i>
            <div>
              <h4>Return Delivery</h4>
              <p>Free 7 Days Delivery Returns. Details</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Details Table -->
    <div class="product-details-section">
      <h3>Product details</h3>
      <table class="details-table">
        <tr>
          <td>Product</td>
          <td><%= product.productName%></td>
        </tr>
       <tr>
         <td>Category</td>
<td><%= product.category.name  %></td>
        </tr>
        <tr>
          <td>Status</td>
         <td>
  <%= product.isBlocked ? "Blocked by Admin" : "Available" %>
</td>
        </tr>
      </table>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab-buttons">
        <button class="active" onclick="openTab(event, 'desc')">Description</button>
        <button onclick="openTab(event, 'specs')">Specifications</button>
        <button onclick="openTab(event, 'reviews')">Reviews</button>
      </div>
      <div id="desc" class="tab-content active">
        <p><%= product.about %></p>
      </div>
      <div id="specs" class="tab-content">
  <ul>
    <li>Category: <%= product.category ? product.category.name : "N/A" %></li>
    <li>Price: â‚¹<%= product.salesPrice %></li>
    <li>Status: <%= product.status %></li>
  </ul>
</div>
      <div id="reviews" class="tab-content">
        <p>No reviews yet. Be the first to review this product!</p>
      </div>
    </div>

    <!-- Related Products -->
    <div class="related-products">
  <h2>Related Items</h2>
  <div class="related-grid">
    <% if (relatedProducts && relatedProducts.length > 0) { %>
      <% relatedProducts.forEach(rp => { %>
        <div class="related-item" onclick="window.location.href='/productDetails/<%= rp._id %>'">
          <div class="related-item-img">
            <img src="/Uploads/product-images/<%= rp.productImage[0] %>" alt="<%= rp.productName %>">
          </div>
          <div class="related-item-info">
            <div class="rating">
              <% let relRating = rp.rating || 4; %>
              <% for(let i=0; i<5; i++) { %>
                <% if(i < relRating) { %>
                  <i class="fa fa-star"></i>
                <% } else { %>
                  <i class="fa fa-star-o"></i>
                <% } %>
              <% } %>
            </div>
            <h5><%= rp.productName %></h5>
            <div class="price">â‚¹<%= rp.salesPrice %></div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p>No related products found</p>
    <% } %>
  </div>
</div>

      
  </div>

  <%- include("partials/user/footer") %>





<script>
  // Quantity functions
  function updatePrice() {
    const qty = parseInt(document.getElementById("quantity").value);
    const priceEl = document.getElementById("totalPrice");
    const originalEl = document.getElementById("originalPrice");

    const basePrice = parseFloat(priceEl.dataset.basePrice);
    const originalPrice = parseFloat(originalEl.dataset.originalPrice);

    const totalPrice = basePrice * qty;
    const totalOriginal = originalPrice * qty;

    priceEl.innerText = `â‚¹${totalPrice.toLocaleString("en-IN")}`;
    originalEl.innerText = `â‚¹${totalOriginal.toLocaleString("en-IN")}`;
  }

  function increaseQty() {
    const input = document.getElementById("quantity");
    input.value = parseInt(input.value) + 1;
    updatePrice();
  }

  function decreaseQty() {
    const input = document.getElementById('quantity');
    if (parseInt(input.value) > 1) {
      input.value = parseInt(input.value) - 1;
      updatePrice();
    }
  }

  // Tab switching
  function openTab(evt, tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-buttons button').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    evt.currentTarget.classList.add('active');
  }

  // Thumbnail image change + zoom reinitialize
  function changeImage(thumb) {
    const mainImg = $("#mainImage");

    // Update sources
    const newSrc = thumb.src;
    mainImg.attr("src", newSrc);
    mainImg.data("zoom-image", newSrc);   // â† important: use .data()

    // Remove previous zoom completely
    $('.zoomContainer').remove();
    mainImg.removeData('elevateZoom');

    // Re-apply zoom with Flipkart-like settings
    mainImg.elevateZoom({
      zoomType: "lens",
      lensShape: "round",
      lensSize: 180,                // size of the lens (adjust 150â€“250)
      lensBorderSize: 2,
      lensBorderColour: "#333",
      borderSize: 1,
      borderColour: "#ddd",
      cursor: "zoom-in",            // or "crosshair"
      containLensZoom: true,        // keeps lens inside image bounds
      scrollZoom: true,             // zoom with mouse wheel
      responsive: true              // good if your layout is responsive
    });

    // Update active thumbnail class
    document.querySelectorAll('.thumbnail-column img')
      .forEach(t => t.classList.remove('active'));
    thumb.classList.add('active');
  }

  // Initial zoom setup on page load
  $(function () {
    $("#mainImage").elevateZoom({
      zoomType: "lens",
      lensShape: "round",
      lensSize: 180,
      lensBorderSize: 2,
      lensBorderColour: "#333",
      borderSize: 1,
      borderColour: "#ddd",
      cursor: "zoom-in",
      containLensZoom: true,
      scrollZoom: true,
      responsive: true
    });
  });
</script>
</body>
</html>