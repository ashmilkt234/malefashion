<%- include('../partials/admin/header') %>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Management Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <link rel="stylesheet" href="/css/product.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    thead {
      background-color: #f5f5f5;
    }

    .product-image {
      width: 40px;
      height: 40px;
      background-color: #ccc;
      border-radius: 5px;
    }

    .color-dots {
      display: flex;
      gap: 5px;
    }

    .color-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .color-black { background-color: black; }
    .color-gray { background-color: gray; }
    .color-pink { background-color: pink; }

    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      margin-right: 5px;
    }

    .pagination {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="main-content">

 <div class="header">
      <div class="header-left">
        <button class="back-btn">
          <i data-lucide="chevron-left"></i>
        </button>
        <h1 class="header-title">Product Page</h1>
      </div>
      <div class="header-right">
        <div class="search-container">
          <i data-lucide="search" class="search-icon"></i>
          <!-- <input type="text" id="searchInput" placeholder="Search products..."/> -->
        </div>
      </div>
    </div>


 <div class="products-section">
      <div class="products-card">
        <div class="products-header">
          <h2 class="products-title">Products</h2>
          <a href="/admin/addProduct" class="add-link">+ Add Product</a>
        </div>

        <table>
          <thead>
            <tr>
   
              <th>Product Name</th>
              <th>Category</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Action</th>
              <th>Edit</th>
                 
            </tr>
          </thead>
          <tbody id="tableBody">
          <tbody>
<% for (let i = data.length - 1; i >= 0; i--) { %>
  <tr>
    <td><%= data[i].productName %></td>
    <td><%= data[i].category.name %></td>
    <td><%= data[i].salesPrice %></td>
    <td><%= data[i].quantity %></td>

<td>
  <% if (!data[i].isBlocked) { %>
    <!-- Green Block button -->
    <a href="javascript:void(0);" 
       onclick="confirmBlock('<%= data[i]._id %>')" 
       class="btn text-white"
       style="width: 80px; background-color: #28a745; padding: 6px 16px; border-radius: 6px; text-decoration: none;">
      Block
    </a>
  <% } else { %>
    <!-- Red Unblock button -->
    <a href="javascript:void(0);" 
       onclick="confirmUnblock('<%= data[i]._id %>')" 
       class="btn text-white"
       style="width: 80px; background-color: #dc3545; padding: 6px 16px; border-radius: 6px; text-decoration: none;">
      Unblock
    </a>
  <% } %>
</td>


<td>
  <a href="/admin/editProduct/<%= data[i]._id %>"
     class="btn text-white ms-2"
     style="width: 80px; background-color: yellow; padding: 6px 16px; border-radius: 6px; text-decoration: none;">
    <i class="bi bi-pencil-square fs-5"></i> Edit
  </a>
</td>

</td>

  </tr>
<% } %>
</tbody>

        </table>

        <div class="pagination">
          <div class="pagination-info">
            Showing <span id="showingStart">1</span>-<span id="showingEnd">0</span> of <span id="totalCount">0</span>
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" id="prevBtn"><i data-lucide="chevron-left"></i></button>
            <button class="pagination-btn" id="nextBtn"><i data-lucide="chevron-right"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div> 

  <script>
   
  function confirmBlock(productId) {
    swal({
      title: "Are you sure?",
      text: "This product will be blocked!",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    }).then((willBlock) => {
      if (willBlock) {
        window.location.href = `/admin/blockProduct?id=${productId}`;
      }
    });
  }

  function confirmUnblock(productId) {
    swal({
      title: "Are you sure?",
      text: "This product will be unblocked!",
      icon: "warning",
      buttons: true,
      dangerMode: false,
    }).then((willUnblock) => {
      if (willUnblock) {
        window.location.href = `/admin/unblockProduct?id=${productId}`;
      }
    });
  }


    lucide.createIcons();



    let filteredProducts = [...products];
    let currentPage = 1;
    const itemsPerPage = 5;

    const tableBody = document.getElementById('tableBody');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const showingStart = document.getElementById('showingStart');
    const showingEnd = document.getElementById('showingEnd');
    const totalCount = document.getElementById('totalCount');
    const searchInput = document.getElementById('searchInput');

    function renderProducts() {
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageProducts = filteredProducts.slice(start, end);

      tableBody.innerHTML = pageProducts.map(product => `
        <tr>
          <td><div class="product-image"></div></td>
          <td>${product.name}</td>
          <td>${product.brand}</td>
          <td>${product.category}</td>
          <td>â‚¹${product.price.toFixed(2)}</td>
          <td>${product.stock}</td>
          <td>
            <div class="color-dots">
              ${product.colors.map(color => `<span class="color-dot color-${color}"></span>`).join('')}
            </div>
          </td>
          <td>
            <button class="action-btn" onclick="editProduct(${product.id})"><i data-lucide="edit"></i></button>
            <button class="action-btn" onclick="deleteProduct(${product.id})"><i data-lucide="trash-2"></i></button>
          </td>
        </tr>
      `).join('');

      lucide.createIcons();

      // Update pagination info
      const totalItems = filteredProducts.length;
      showingStart.textContent = totalItems > 0 ? start + 1 : 0;
      showingEnd.textContent = Math.min(end, totalItems);
      totalCount.textContent = totalItems;

      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = end >= totalItems;
    }

    function handleSearch() {
      const term = searchInput.value.toLowerCase();
      filteredProducts = products.filter(p =>
        p.name.toLowerCase().includes(term) || p.brand.toLowerCase().includes(term)
      );
      currentPage = 1;
      renderProducts();
    }

    function editProduct(id) {
      alert("Edit product " + id);
    }

    function deleteProduct(id) {
      if (confirm("Are you sure you want to delete this product?")) {
        products = products.filter(p => p.id !== id);
        filteredProducts = filteredProducts.filter(p => p.id !== id);
        renderProducts();
      }
    }

    function handlePagination() {
      prevBtn.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderProducts();
        }
      });

      nextBtn.addEventListener("click", () => {
        if ((currentPage * itemsPerPage) < filteredProducts.length) {
          currentPage++;
          renderProducts();
        }
      });
    }

    searchInput.addEventListener("input", handleSearch);

    document.addEventListener("DOMContentLoaded", () => {
      renderProducts();
      handlePagination();
    });
  </script> 
</body>
</html> 
